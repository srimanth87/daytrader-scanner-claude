<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NDX100 â€” Day Trading Momentum Scanner</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#04070a; --card:#070d12; --border:#0d1f2d;
  --green:#00ff88; --red:#ff3355; --yellow:#ffd700;
  --accent:#00d4ff; --purple:#c084fc; --orange:#fb923c;
  --dim:#3a5a6a; --text:#ddeeff; --muted:#1a3040;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'JetBrains Mono',monospace;min-height:100vh}
.gridbg{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.18;
  background-image:linear-gradient(rgba(0,212,255,0.3) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,212,255,0.3) 1px,transparent 1px);
  background-size:40px 40px}
.wrap{max-width:1380px;margin:0 auto;padding:24px 20px;position:relative;z-index:1}

/* Header */
.hdr{display:flex;justify-content:space-between;align-items:flex-end;
  border-bottom:1px solid var(--border);padding-bottom:16px;margin-bottom:18px}
.title{font-family:'Bebas Neue',sans-serif;font-size:48px;line-height:1;
  background:linear-gradient(135deg,var(--accent),var(--green));
  -webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:.05em}
.sub{font-size:9px;color:var(--dim);letter-spacing:.2em;margin-top:5px;text-transform:uppercase}
.hdr-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.scan-btn{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:.12em;
  background:var(--green);color:#000;border:none;padding:12px 32px;
  cursor:pointer;transition:all .2s;box-shadow:0 0 24px rgba(0,255,136,.25)}
.scan-btn:hover{background:#00ffaa;box-shadow:0 0 40px rgba(0,255,136,.5)}
.scan-btn:disabled{background:var(--muted);color:var(--dim);cursor:not-allowed;box-shadow:none}
.api-note{font-size:9px;color:var(--dim);letter-spacing:.06em;text-align:right}
.api-note span{color:var(--green)}
.market-status{display:flex;align-items:center;gap:7px;font-size:10px}
.mdot{width:7px;height:7px;border-radius:50%;animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.25}}

/* Legend */
.legend{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.leg{display:flex;align-items:center;gap:6px;background:var(--card);
  border:1px solid var(--border);padding:5px 11px;border-radius:2px;font-size:10px;color:var(--dim)}
.ldot{width:6px;height:6px;border-radius:50%}

/* Regime */
.regime{display:flex;gap:2px;margin-bottom:16px}
.reg-card{flex:1;background:var(--card);border:1px solid var(--border);
  padding:12px 16px;display:flex;align-items:center;gap:10px;font-size:11px}
.reg-icon{font-size:18px}
.reg-val{font-size:13px;font-weight:700}
.reg-lbl{font-size:9px;color:var(--dim);letter-spacing:.1em;text-transform:uppercase}

/* Progress */
.prog-wrap{margin-bottom:12px;display:none}
.prog-wrap.on{display:block}
.prog-lbl{font-size:9px;color:var(--dim);letter-spacing:.08em;margin-bottom:5px;display:flex;justify-content:space-between}
.prog-bg{height:2px;background:var(--muted);border-radius:2px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--green));border-radius:2px;transition:width .3s}

/* Log */
.log{background:var(--card);border:1px solid var(--border);padding:10px 14px;
  max-height:110px;overflow:auto;font-size:10px;line-height:1.9;margin-bottom:14px;display:none}
.log.on{display:block}
.lok{color:var(--green)} .lerr{color:var(--red)} .linfo{color:var(--accent)} .lwarn{color:var(--yellow)}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(6,1fr);gap:1px;background:var(--border);margin-bottom:16px}
.stat{background:var(--card);padding:14px 10px;text-align:center}
.snum{font-family:'Bebas Neue',sans-serif;font-size:32px;line-height:1;color:var(--text)}
.snum.g{color:var(--green)} .snum.y{color:var(--yellow)} .snum.p{color:var(--purple)} .snum.a{color:var(--accent)}
.slbl{font-size:8px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase;margin-top:4px}

/* Table */
.tbl-outer{background:var(--card);border:1px solid var(--border);overflow:hidden}
.thead,.trow{display:grid;
  grid-template-columns:50px 100px 200px 110px 75px 90px 90px 80px 80px 80px;
  border-bottom:1px solid var(--border)}
.thead{background:rgba(0,212,255,.04)}
.thead>div{padding:9px 10px;font-size:9px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase}
.trow{background:var(--card);transition:background .15s;position:relative}
.trow:hover{background:#0a1520}
.trow:last-child{border-bottom:none}
.trow.fadeIn{animation:fadeIn .45s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:translateX(0)}}
.cell{padding:12px 10px;display:flex;align-items:center;font-size:11px;border-right:1px solid rgba(13,31,45,.7)}
.cell:last-child{border-right:none}
.cell.col{flex-direction:column;align-items:flex-start;gap:2px}
.rankbar{position:absolute;left:0;top:0;bottom:0;width:3px}
.rnum{font-family:'Bebas Neue',sans-serif;font-size:24px;line-height:1}
.rnum.gold{color:#f59e0b} .rnum.silver{color:#94a3b8} .rnum.bronze{color:#b45309}
.tsym{font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:.04em;color:var(--text)}
.tname{font-size:9px;color:var(--dim);margin-top:1px}
.sig-main{font-size:11px;font-weight:600}
.sig-tags{display:flex;gap:4px;flex-wrap:wrap;margin-top:4px}
.tag{font-size:8px;padding:2px 6px;border-radius:2px;letter-spacing:.06em;font-weight:600}
.tg{background:rgba(0,255,136,.1);color:var(--green);border:1px solid rgba(0,255,136,.2)}
.ty{background:rgba(255,215,0,.1);color:var(--yellow);border:1px solid rgba(255,215,0,.2)}
.tp{background:rgba(192,132,252,.1);color:var(--purple);border:1px solid rgba(192,132,252,.2)}
.ta{background:rgba(0,212,255,.1);color:var(--accent);border:1px solid rgba(0,212,255,.2)}
.tr{background:rgba(255,51,85,.1);color:var(--red);border:1px solid rgba(255,51,85,.2)}
.to{background:rgba(251,146,60,.1);color:var(--orange);border:1px solid rgba(251,146,60,.2)}
.pval{font-size:14px;font-weight:700;color:var(--text)}
.chg{font-size:11px;font-weight:700}
.chg.pos{color:var(--green)} .chg.neg{color:var(--red)}
.bar-mini{width:44px;height:3px;background:var(--muted);border-radius:2px;overflow:hidden;margin-top:4px}
.bar-fill{height:100%;border-radius:2px}
.bf-g{background:var(--green)} .bf-r{background:var(--red)} .bf-y{background:var(--yellow)}
.bf-p{background:linear-gradient(90deg,#7c3aed,#c084fc)} .bf-a{background:linear-gradient(90deg,#0284c7,var(--accent))}
.bf-o{background:var(--orange)} .bf-d{background:var(--dim)}
.score-num{font-family:'Bebas Neue',sans-serif;font-size:28px;line-height:1}
.score-denom{font-size:9px;color:var(--dim)}
.score-bar{width:44px;height:2px;background:var(--muted);border-radius:2px;overflow:hidden;margin-top:4px}
.score-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--green))}
.msg{padding:50px;text-align:center;color:var(--dim);font-size:13px;letter-spacing:.05em}
.spin{display:inline-block;width:9px;height:9px;border:2px solid var(--dim);
  border-top-color:var(--green);border-radius:50%;animation:spin .8s linear infinite;
  margin-right:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
.foot{margin-top:14px;font-size:9px;color:var(--muted);letter-spacing:.05em;display:flex;justify-content:space-between}
</style>
</head>
<body>
<div class="gridbg"></div>
<div class="wrap">

  <div class="hdr">
    <div>
      <div class="title">NDX100 DAY TRADER</div>
      <div class="sub">Mid-day Momentum Â· Breakout Scoring Â· All 100 Tickers Â· Top 10 to Buy Now</div>
    </div>
    <div class="hdr-right">
      <button class="scan-btn" id="scanBtn" onclick="runScan()">&#9654; SCAN ALL 100</button>
      <div class="api-note"><span>No API key needed</span> Â· Yahoo Finance Â· ~60s scan</div>
      <div class="market-status">
        <div class="mdot" id="mdot" style="background:var(--dim)"></div>
        <span id="mtext" style="color:var(--dim)">READY</span>
        <span id="mtime" style="color:var(--dim);margin-left:8px"></span>
      </div>
    </div>
  </div>

  <div class="legend">
    <div class="leg"><div class="ldot" style="background:var(--green)"></div>Intraday % gain</div>
    <div class="leg"><div class="ldot" style="background:var(--yellow)"></div>Volume surge vs 20-day avg</div>
    <div class="leg"><div class="ldot" style="background:var(--accent)"></div>Relative strength vs SPY</div>
    <div class="leg"><div class="ldot" style="background:var(--purple)"></div>Gap up held</div>
    <div class="leg"><div class="ldot" style="background:var(--orange)"></div>Range expansion vs ATR</div>
    <div class="leg"><div class="ldot" style="background:var(--red)"></div>Above 20-day EMA</div>
  </div>

  <div class="regime" id="regime">
    <div class="reg-card"><div class="reg-icon">ğŸ“ˆ</div><div><div class="reg-val" id="spyChg" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY Today</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸ“Š</div><div><div class="reg-val" id="spyVR" style="color:var(--dim)">â€”</div><div class="reg-lbl">SPY Vol Ratio</div></div></div>
    <div class="reg-card"><div class="reg-icon">ğŸŒ¡ï¸</div><div><div class="reg-val" id="mktReg" style="color:var(--dim)">â€”</div><div class="reg-lbl">Market Regime</div></div></div>
    <div class="reg-card"><div class="reg-icon">âš¡</div><div><div class="reg-val" id="scanTime" style="color:var(--dim)">â€”</div><div class="reg-lbl">Scan Time</div></div></div>
  </div>

  <div class="prog-wrap" id="progWrap">
    <div class="prog-lbl"><span id="progLbl">Scanning...</span><span id="progPct">0%</span></div>
    <div class="prog-bg"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
  </div>

  <div class="log" id="logBox"></div>

  <div class="stats">
    <div class="stat"><div class="snum" id="sScanned">&#8212;</div><div class="slbl">Scanned</div></div>
    <div class="stat"><div class="snum g" id="sGainers">&#8212;</div><div class="slbl">Gaining &gt;1%</div></div>
    <div class="stat"><div class="snum y" id="sVolSurge">&#8212;</div><div class="slbl">Vol Surge &gt;1.5x</div></div>
    <div class="stat"><div class="snum a" id="sRS">&#8212;</div><div class="slbl">Beats SPY</div></div>
    <div class="stat"><div class="snum p" id="sGapUp">&#8212;</div><div class="slbl">Gap Up Held</div></div>
    <div class="stat"><div class="snum" id="sAvgChg">&#8212;</div><div class="slbl">Avg Chg%</div></div>
  </div>

  <div class="tbl-outer">
    <div class="thead">
      <div>#</div><div>Ticker</div><div>Signal</div><div>Price</div>
      <div>Chg%</div><div>Vol Ratio</div><div>Rel Str</div>
      <div>Gap%</div><div>ATR Ratio</div><div>Score</div>
    </div>
    <div id="tbody"><div class="msg">Press SCAN ALL 100 to load live momentum data</div></div>
  </div>

  <div class="foot">
    <span>Yahoo Finance (via corsproxy.io) Â· Daily OHLCV Â· Vol ratio, ATR, gap, relative strength vs SPY Â· No API key needed</span>
    <span id="footTime"></span>
  </div>
</div>

<script>
// â”€â”€ Full NDX-100 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TICKERS = [
  {sym:"AAPL",  name:"Apple"},           {sym:"MSFT",  name:"Microsoft"},
  {sym:"NVDA",  name:"NVIDIA"},          {sym:"AMZN",  name:"Amazon"},
  {sym:"META",  name:"Meta Platforms"},  {sym:"TSLA",  name:"Tesla"},
  {sym:"GOOGL", name:"Alphabet A"},      {sym:"GOOG",  name:"Alphabet C"},
  {sym:"AVGO",  name:"Broadcom"},        {sym:"COST",  name:"Costco"},
  {sym:"NFLX",  name:"Netflix"},         {sym:"AMD",   name:"AMD"},
  {sym:"ADBE",  name:"Adobe"},           {sym:"QCOM",  name:"Qualcomm"},
  {sym:"TMUS",  name:"T-Mobile"},        {sym:"TXN",   name:"Texas Instruments"},
  {sym:"AMAT",  name:"Applied Materials"},{sym:"INTU", name:"Intuit"},
  {sym:"MU",    name:"Micron"},          {sym:"LRCX",  name:"Lam Research"},
  {sym:"ISRG",  name:"Intuitive Surgical"},{sym:"AMGN",name:"Amgen"},
  {sym:"BKNG",  name:"Booking Holdings"},{sym:"ADI",   name:"Analog Devices"},
  {sym:"KLAC",  name:"KLA Corp"},        {sym:"MRVL",  name:"Marvell Tech"},
  {sym:"REGN",  name:"Regeneron"},       {sym:"SNPS",  name:"Synopsys"},
  {sym:"CDNS",  name:"Cadence Design"},  {sym:"CSX",   name:"CSX Corp"},
  {sym:"FTNT",  name:"Fortinet"},        {sym:"PANW",  name:"Palo Alto"},
  {sym:"CRWD",  name:"CrowdStrike"},     {sym:"MELI",  name:"MercadoLibre"},
  {sym:"ASML",  name:"ASML Holding"},    {sym:"ORLY",  name:"O'Reilly Auto"},
  {sym:"ROST",  name:"Ross Stores"},     {sym:"ABNB",  name:"Airbnb"},
  {sym:"PAYX",  name:"Paychex"},         {sym:"CTAS",  name:"Cintas"},
  {sym:"MNST",  name:"Monster Beverage"},{sym:"IDXX",  name:"IDEXX Labs"},
  {sym:"TEAM",  name:"Atlassian"},       {sym:"FAST",  name:"Fastenal"},
  {sym:"DXCM",  name:"Dexcom"},          {sym:"VRSK",  name:"Verisk"},
  {sym:"ON",    name:"ON Semiconductor"},{sym:"ODFL",  name:"Old Dominion"},
  {sym:"CPRT",  name:"Copart"},          {sym:"BIIB",  name:"Biogen"},
  {sym:"EXC",   name:"Exelon"},          {sym:"GEHC",  name:"GE HealthCare"},
  {sym:"KHC",   name:"Kraft Heinz"},     {sym:"MRNA",  name:"Moderna"},
  {sym:"PCAR",  name:"PACCAR"},          {sym:"DLTR",  name:"Dollar Tree"},
  {sym:"ZS",    name:"Zscaler"},         {sym:"ANSS",  name:"ANSYS"},
  {sym:"CCEP",  name:"Coca-Cola EP"},    {sym:"CEG",   name:"Constellation Energy"},
  {sym:"CTSH",  name:"Cognizant"},       {sym:"DDOG",  name:"Datadog"},
  {sym:"ILMN",  name:"Illumina"},        {sym:"TTD",   name:"The Trade Desk"},
  {sym:"WDAY",  name:"Workday"},         {sym:"XEL",   name:"Xcel Energy"},
  {sym:"AEP",   name:"American Electric"},{sym:"AXON", name:"Axon Enterprise"},
  {sym:"CSGP",  name:"CoStar Group"},    {sym:"GILD",  name:"Gilead Sciences"},
  {sym:"MCHP",  name:"Microchip Tech"},  {sym:"NTAP",  name:"NetApp"},
  {sym:"PDD",   name:"PDD Holdings"},    {sym:"ROP",   name:"Roper Tech"},
  {sym:"SBUX",  name:"Starbucks"},       {sym:"TTWO",  name:"Take-Two"},
  {sym:"VRTX",  name:"Vertex Pharma"},   {sym:"ALGN",  name:"Align Tech"},
  {sym:"AZN",   name:"AstraZeneca"},     {sym:"CHTR",  name:"Charter Comm."},
  {sym:"CMCSA", name:"Comcast"},         {sym:"CSCO",  name:"Cisco"},
  {sym:"EA",    name:"Electronic Arts"}, {sym:"EBAY",  name:"eBay"},
  {sym:"ENPH",  name:"Enphase Energy"},  {sym:"INTC",  name:"Intel"},
  {sym:"MAR",   name:"Marriott"},        {sym:"MDLZ",  name:"Mondelez"},
  {sym:"NXPI",  name:"NXP Semiconductors"},{sym:"PYPL",name:"PayPal"},
  {sym:"RIVN",  name:"Rivian"},          {sym:"WDC",   name:"Western Digital"},
  {sym:"SMCI",  name:"Super Micro"},     {sym:"ARM",   name:"Arm Holdings"},
  {sym:"APP",   name:"AppLovin"},        {sym:"PLTR",  name:"Palantir"},
  {sym:"MSTR",  name:"MicroStrategy"},   {sym:"HOOD",  name:"Robinhood"},
  {sym:"COIN",  name:"Coinbase"},        {sym:"RBLX",  name:"Roblox"},
];

// â”€â”€ Yahoo Finance via CORS proxy â€” fetches daily OHLCV history â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchYahoo(sym) {
  const to   = Math.floor(Date.now() / 1000);
  const from = to - 120 * 86400; // 120 days â€” enough for vol avg + ATR

  const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=1d&period1=${from}&period2=${to}`;
  const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(yahooUrl)}`;

  const r = await fetch(proxyUrl);
  if (!r.ok) throw new Error(`HTTP ${r.status}`);
  const json = await r.json();

  const res = json?.chart?.result?.[0];
  if (!res) throw new Error(json?.chart?.error?.description || "No data");

  const q    = res.indicators.quote[0];
  const adj  = res.indicators.adjclose?.[0]?.adjclose || q.close;
  const ts   = res.timestamp;

  const rows = ts.map((t,i) => ({
    c: adj[i], h: q.high[i], l: q.low[i], o: q.open[i], v: q.volume[i]
  })).filter(x => x.c!=null && x.h!=null && x.l!=null && x.v!=null);

  if (rows.length < 25) throw new Error(`Only ${rows.length} days`);

  return {
    closes:  rows.map(x=>x.c),
    highs:   rows.map(x=>x.h),
    lows:    rows.map(x=>x.l),
    opens:   rows.map(x=>x.o),
    volumes: rows.map(x=>x.v),
    price:   res.meta.regularMarketPrice || rows[rows.length-1].c,
    prevClose: res.meta.previousClose    || rows[rows.length-2]?.c || rows[rows.length-1].c,
    chgPct:  res.meta.regularMarketChangePercent || 0,
  };
}

// â”€â”€ Indicators â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sma(arr, n) {
  if (arr.length < n) return null;
  return arr.slice(-n).reduce((a,b)=>a+b,0)/n;
}

function ema(arr, n) {
  if (arr.length < n) return null;
  const k=2/(n+1);
  let v=arr.slice(0,n).reduce((a,b)=>a+b,0)/n;
  for (let i=n;i<arr.length;i++) v=arr[i]*k+v*(1-k);
  return v;
}

function avgVolume(volumes) {
  // average of last 20 days EXCLUDING today (last element)
  const slice = volumes.slice(-21, -1);
  if (slice.length < 5) return null;
  return slice.reduce((a,b)=>a+b,0)/slice.length;
}

function atr14(highs, lows, closes) {
  const n=14;
  if (closes.length < n+1) return null;
  const trs=[];
  for (let i=closes.length-n;i<closes.length;i++)
    trs.push(Math.max(highs[i]-lows[i],Math.abs(highs[i]-closes[i-1]),Math.abs(lows[i]-closes[i-1])));
  return trs.reduce((a,b)=>a+b,0)/n;
}

// â”€â”€ Scoring (max 14 pts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MAX = 14;

function score(d, spyChgPct) {
  let pts=0; const tags=[];

  // 1. Intraday % change â€” core momentum (max 4 pts)
  if      (d.chgPct >= 3) { pts+=4; tags.push({t:`ğŸ”¥ +${d.chgPct.toFixed(1)}%`, c:"tg"}); }
  else if (d.chgPct >= 2) { pts+=3; tags.push({t:`â–² +${d.chgPct.toFixed(1)}%`,  c:"tg"}); }
  else if (d.chgPct >= 1) { pts+=2; tags.push({t:`â–² +${d.chgPct.toFixed(1)}%`,  c:"ty"}); }
  else if (d.chgPct >= 0) { pts+=1; tags.push({t:`â†’ +${d.chgPct.toFixed(1)}%`,  c:"ta"}); }
  else                    {         tags.push({t:`â–¼ ${d.chgPct.toFixed(1)}%`,    c:"tr"}); }

  // 2. Volume surge vs 20-day avg (max 3 pts)
  if      (d.volRatio >= 2.5) { pts+=3; tags.push({t:`VOL ${d.volRatio.toFixed(1)}x ğŸš€`, c:"tg"}); }
  else if (d.volRatio >= 1.5) { pts+=2; tags.push({t:`VOL ${d.volRatio.toFixed(1)}x â†‘`,  c:"ty"}); }
  else if (d.volRatio >= 1.1) { pts+=1; tags.push({t:`VOL ${d.volRatio.toFixed(1)}x`,     c:"ta"}); }
  else if (d.volRatio >  0)   {         tags.push({t:`VOL LOW ${d.volRatio.toFixed(1)}x`,  c:"tr"}); }

  // 3. Relative strength vs SPY (max 2 pts)
  const rs = d.chgPct - spyChgPct;
  if      (rs > 1.5) { pts+=2; tags.push({t:`RS +${rs.toFixed(1)}% vs SPY`, c:"tg"}); }
  else if (rs > 0)   { pts+=1; tags.push({t:`RS +${rs.toFixed(1)}% vs SPY`, c:"ty"}); }
  else               {         tags.push({t:`RS ${rs.toFixed(1)}% vs SPY`,   c:"tr"}); }

  // 4. Gap up held â€” open > prev close (max 2 pts)
  if      (d.gapPct >= 1.5) { pts+=2; tags.push({t:`GAP UP +${d.gapPct.toFixed(1)}%`, c:"tp"}); }
  else if (d.gapPct >= 0.3) { pts+=1; tags.push({t:`GAP +${d.gapPct.toFixed(1)}%`,    c:"ta"}); }

  // 5. ATR range expansion (max 1 pt)
  if (d.atrRatio >= 1.3) { pts+=1; tags.push({t:`RANGE ${d.atrRatio.toFixed(1)}x ATR`, c:"to"}); }

  // 6. Price above EMA20 (max 2 pts)
  if      (d.aboveEMA20 === true)  { pts+=2; tags.push({t:"ABOVE EMA20 âœ“", c:"tg"}); }
  else if (d.aboveEMA20 === false) {         tags.push({t:"BELOW EMA20",   c:"tr"}); }

  return {pts, tags, rs};
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rankBarColor(i){return i===0?"#f59e0b":i===1?"#94a3b8":i===2?"#b45309":"#0d1f2d"}
function rankNumCls(i){return i===0?"gold":i===1?"silver":i===2?"bronze":""}

function sigLabel(pts){
  if (pts>=11) return `<span class="sig-main" style="color:var(--green)">ğŸ”¥ STRONG MOMENTUM</span>`;
  if (pts>=8)  return `<span class="sig-main" style="color:var(--yellow)">âš¡ MOMENTUM</span>`;
  if (pts>=5)  return `<span class="sig-main" style="color:var(--accent)">â—ˆ WATCH</span>`;
  return `<span class="sig-main" style="color:var(--dim)">â—‡ WEAK</span>`;
}

function renderRow(d, s, rank, delay){
  const chgCls=d.chgPct>=0?"pos":"neg", chgSign=d.chgPct>=0?"â–²":"â–¼";
  const vrColor=d.volRatio>=2?"bf-g":d.volRatio>=1.2?"bf-y":"bf-r";
  const rsColor=s.rs>0?"bf-g":"bf-r";
  const gapColor=d.gapPct>=1?"bf-g":d.gapPct>=0?"bf-y":"bf-r";
  const atrColor=d.atrRatio>=1.3?"bf-o":"bf-d";
  const scoreColor=s.pts>=11?"#00ff88":s.pts>=8?"#ffd700":s.pts>=5?"#00d4ff":"#3a5a6a";
  const tags=s.tags.map(t=>`<span class="tag ${t.c}">${t.t}</span>`).join("");

  return `<div class="trow fadeIn" style="animation-delay:${delay}s">
    <div class="rankbar" style="background:${rankBarColor(rank)}"></div>
    <div class="cell"><span class="rnum ${rankNumCls(rank)}">${rank+1}</span></div>
    <div class="cell col"><span class="tsym">${d.sym}</span><span class="tname">${d.name}</span></div>
    <div class="cell col">${sigLabel(s.pts)}<div class="sig-tags">${tags}</div></div>
    <div class="cell col">
      <span class="pval">$${d.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
      <span class="chg ${chgCls}">${chgSign} ${Math.abs(d.chgPct).toFixed(2)}%</span>
    </div>
    <div class="cell col">
      <span style="font-size:14px;font-weight:700" class="chg ${chgCls}">${chgSign}${Math.abs(d.chgPct).toFixed(2)}%</span>
      <div class="bar-mini"><div class="bar-fill ${d.chgPct>=0?"bf-g":"bf-r"}" style="width:${Math.min(100,Math.abs(d.chgPct)/5*100)}%"></div></div>
    </div>
    <div class="cell col">
      <span style="font-size:13px;font-weight:700;color:${d.volRatio>=1.5?"var(--yellow)":d.volRatio>=1?"var(--text)":"var(--dim)"}">${d.volRatio>0?d.volRatio.toFixed(2)+"x":"â€”"}</span>
      <div class="bar-mini"><div class="bar-fill ${vrColor}" style="width:${Math.min(100,(d.volRatio/3)*100)}%"></div></div>
    </div>
    <div class="cell col">
      <span style="font-size:13px;font-weight:700;color:${s.rs>0?"var(--green)":"var(--red)"}">${s.rs>=0?"+":""}${s.rs.toFixed(2)}%</span>
      <div class="bar-mini"><div class="bar-fill ${rsColor}" style="width:${Math.min(100,Math.max(0,(s.rs+3)/6*100))}%"></div></div>
    </div>
    <div class="cell col">
      <span style="font-size:13px;font-weight:700;color:${d.gapPct>=1?"var(--green)":d.gapPct>=0?"var(--yellow)":"var(--red)"}">${d.gapPct>=0?"+":""}${d.gapPct.toFixed(2)}%</span>
      <div class="bar-mini"><div class="bar-fill ${gapColor}" style="width:${Math.min(100,Math.abs(d.gapPct)/4*100)}%"></div></div>
    </div>
    <div class="cell col">
      <span style="font-size:13px;font-weight:700;color:${d.atrRatio>=1.3?"var(--orange)":"var(--dim)"}">${d.atrRatio>0?d.atrRatio.toFixed(2)+"x":"â€”"}</span>
      <div class="bar-mini"><div class="bar-fill ${atrColor}" style="width:${Math.min(100,(d.atrRatio/2)*100)}%"></div></div>
    </div>
    <div class="cell col">
      <span class="score-num" style="color:${scoreColor}">${s.pts}</span>
      <span class="score-denom">/${MAX}</span>
      <div class="score-bar"><div class="score-fill" style="width:${(s.pts/MAX)*100}%"></div></div>
    </div>
  </div>`;
}

function log(msg,cls=""){
  const box=document.getElementById("logBox");
  box.classList.add("on");
  const d=document.createElement("div");
  d.className=cls; d.textContent=msg;
  box.appendChild(d); box.scrollTop=box.scrollHeight;
}

function updateStats(results, spyChgPct){
  document.getElementById("sScanned").textContent  = results.length;
  document.getElementById("sGainers").textContent  = results.filter(d=>d.chgPct>=1).length;
  document.getElementById("sVolSurge").textContent = results.filter(d=>d.volRatio>=1.5).length;
  document.getElementById("sRS").textContent       = results.filter(d=>d.chgPct>spyChgPct).length;
  document.getElementById("sGapUp").textContent    = results.filter(d=>d.gapPct>=0.5).length;
  const avg=results.length?(results.reduce((a,b)=>a+b.chgPct,0)/results.length).toFixed(2):"â€”";
  const el=document.getElementById("sAvgChg");
  el.textContent=avg!=="â€”"?(parseFloat(avg)>=0?"+":"")+avg+"%":"â€”";
  el.className="snum "+(parseFloat(avg)>=0?"g":"r");
}

function updateTable(results, spyChgPct){
  const scored=results.map(d=>({d, s:score(d,spyChgPct)}));
  scored.sort((a,b)=>b.s.pts!==a.s.pts?b.s.pts-a.s.pts:b.d.chgPct-a.d.chgPct);
  const top10=scored.slice(0,10);
  document.getElementById("tbody").innerHTML=top10.length
    ?top10.map(({d,s},i)=>renderRow(d,s,i,i*0.06)).join("")
    :`<div class="msg">No results yet...</div>`;
}

// â”€â”€ Main scan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runScan(){
  const btn=document.getElementById("scanBtn");
  btn.disabled=true; btn.textContent="SCANNING...";
  document.getElementById("logBox").innerHTML="";
  document.getElementById("logBox").className="log on";
  document.getElementById("progWrap").className="prog-wrap on";
  document.getElementById("tbody").innerHTML=`<div class="msg"><span class="spin"></span>FETCHING LIVE DATA FROM YAHOO FINANCE...</div>`;
  document.getElementById("mdot").style.background="var(--yellow)";
  document.getElementById("mtext").style.color="var(--yellow)";
  document.getElementById("mtext").textContent="SCANNING";
  const t0=Date.now();

  // â”€â”€ Fetch SPY first as market baseline â”€â”€
  let spyChgPct=0, spyVolRatio=0;
  try {
    const spy=await fetchYahoo("SPY");
    spyChgPct=spy.chgPct;
    const avgVol=avgVolume(spy.volumes);
    spyVolRatio=avgVol>0?spy.volumes[spy.volumes.length-1]/avgVol:0;
    document.getElementById("spyChg").textContent=(spyChgPct>=0?"+":"")+spyChgPct.toFixed(2)+"%";
    document.getElementById("spyChg").style.color=spyChgPct>=0?"var(--green)":"var(--red)";
    document.getElementById("spyVR").textContent=spyVolRatio>0?spyVolRatio.toFixed(2)+"x":"â€”";
    document.getElementById("spyVR").style.color="var(--accent)";
    document.getElementById("mktReg").textContent=spyChgPct>=0.3?"BULLISH DAY":spyChgPct<=-0.3?"BEARISH DAY":"CHOPPY";
    document.getElementById("mktReg").style.color=spyChgPct>=0.3?"var(--green)":spyChgPct<=-0.3?"var(--red)":"var(--yellow)";
    log(`âœ“ SPY baseline: ${spyChgPct>=0?"+":""}${spyChgPct.toFixed(2)}% | Vol ratio: ${spyVolRatio.toFixed(2)}x`,"linfo");
  } catch(e){
    log(`âš  SPY fetch failed: ${e.message}`,"lwarn");
  }

  const results=[];
  const total=TICKERS.length;
  let done=0;

  log(`â–º Scanning all ${total} NDX-100 tickers Â· batches of 5 Â· Yahoo Finance`,"linfo");

  // Batches of 5 in parallel, 600ms between batches
  const BATCH=5;
  for (let i=0;i<total;i+=BATCH){
    const batch=TICKERS.slice(i,i+BATCH);

    const batchRes=await Promise.allSettled(batch.map(t=>
      fetchYahoo(t.sym).then(yf=>{
        const {closes,highs,lows,opens,volumes,price,prevClose,chgPct}=yf;
        const avgVol=avgVolume(volumes);
        const todayVol=volumes[volumes.length-1];
        const volRatio=avgVol>0?todayVol/avgVol:0;
        const atr=atr14(highs,lows,closes);
        const todayRange=highs[highs.length-1]-lows[lows.length-1];
        const atrRatio=atr>0?todayRange/atr:0;
        const gapPct=prevClose>0?(opens[opens.length-1]-prevClose)/prevClose*100:0;
        const e20=ema(closes,20);
        return {
          sym:t.sym, name:t.name,
          price, chgPct, prevClose,
          volRatio, atrRatio, gapPct,
          aboveEMA20: e20!=null?price>e20:null,
          todayVol, avgVol,
        };
      })
    ));

    batchRes.forEach((res,j)=>{
      const t=batch[j];
      done++;
      if(res.status==="fulfilled"){
        const d=res.value;
        results.push(d);
        const s=score(d,spyChgPct);
        log(`âœ“ ${t.sym.padEnd(6)} | ${d.chgPct>=0?"+":""}${d.chgPct.toFixed(2)}% | VOL:${d.volRatio>0?d.volRatio.toFixed(1)+"x":"â€”"} | RS:${s.rs>=0?"+":""}${s.rs.toFixed(1)}% | Gap:${d.gapPct>=0?"+":""}${d.gapPct.toFixed(1)}% | ${s.pts}/${MAX}pts`,"lok");
      } else {
        log(`âœ— ${t.sym.padEnd(6)} â€” ${res.reason?.message||"failed"}`,"lerr");
      }
    });

    const pct=Math.round((done/total)*100);
    document.getElementById("progLbl").textContent=`${done}/${total} â€” batch ${Math.ceil((i+BATCH)/BATCH)}/${Math.ceil(total/BATCH)}`;
    document.getElementById("progPct").textContent=pct+"%";
    document.getElementById("progFill").style.width=pct+"%";
    updateStats(results,spyChgPct);
    updateTable(results,spyChgPct);

    if(i+BATCH<total) await new Promise(r=>setTimeout(r,600));
  }

  const elapsed=((Date.now()-t0)/1000).toFixed(1);
  document.getElementById("scanTime").textContent=elapsed+"s";
  document.getElementById("scanTime").style.color="var(--accent)";
  document.getElementById("progWrap").className="prog-wrap";
  document.getElementById("mdot").style.background="var(--green)";
  document.getElementById("mtext").style.color="var(--green)";
  document.getElementById("mtext").textContent="DONE";
  document.getElementById("mtime").textContent=new Date().toLocaleTimeString();
  btn.disabled=false; btn.textContent="â–¶ RESCAN ALL 100";

  // Final sort and top pick
  const scored=results.map(d=>({d,s:score(d,spyChgPct)}));
  scored.sort((a,b)=>b.s.pts!==a.s.pts?b.s.pts-a.s.pts:b.d.chgPct-a.d.chgPct);
  document.getElementById("footTime").textContent=
    `Scanned ${results.length}/${total} Â· Top: ${scored[0]?.d.sym||"â€”"} (${scored[0]?.s.pts||0}/${MAX}) Â· ${new Date().toLocaleTimeString()}`;
  if(scored[0]) log(`\nâ–º TOP PICK: ${scored[0].d.sym} â€” ${scored[0].s.pts}/${MAX}pts Â· +${scored[0].d.chgPct.toFixed(2)}%`,"linfo");
}
</script>
</body>
</html>
